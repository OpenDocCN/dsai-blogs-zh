# äº†è§£ LightGBM å‚æ•°(ä»¥åŠå¦‚ä½•è°ƒæ•´å®ƒä»¬)

> åŸæ–‡ï¼š<https://web.archive.org/web/https://neptune.ai/blog/lightgbm-parameters-guide>

æˆ‘å·²ç»ç”¨äº† [lightGBM](https://web.archive.org/web/20230127191010/https://github.com/microsoft/LightGBM/tree/master/python-package) ä¸€æ®µæ—¶é—´äº†ã€‚è¿™æ˜¯æˆ‘è§£å†³å¤§å¤šæ•°è¡¨æ ¼æ•°æ®é—®é¢˜çš„å¸¸ç”¨ç®—æ³•ã€‚[çš„ä»¤äººæ•¬ç•çš„ç‰¹æ€§](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Features.html)çš„åˆ—è¡¨å¾ˆé•¿ï¼Œæˆ‘å»ºè®®ä½ å¦‚æœè¿˜æ²¡æœ‰çœ‹çš„è¯çœ‹ä¸€çœ‹ã€‚

ä½†æ˜¯æˆ‘ä¸€ç›´å¾ˆæƒ³äº†è§£å“ªäº›å‚æ•°å¯¹æ€§èƒ½å½±å“æœ€å¤§ï¼Œä»¥åŠæˆ‘åº”è¯¥å¦‚ä½•è°ƒä¼˜ lightGBM å‚æ•°ä»¥å……åˆ†åˆ©ç”¨å®ƒã€‚

æˆ‘æƒ³æˆ‘åº”è¯¥åšä¸€äº›ç ”ç©¶ï¼Œäº†è§£æ›´å¤šå…³äº lightGBM çš„å‚æ•°â€¦å¹¶åˆ†äº«æˆ‘çš„æ—…ç¨‹ã€‚

å…·ä½“æ¥è¯´ï¼Œæˆ‘:

åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘è·å¾—äº†æ›´å¤šå…³äº lightGBM å‚æ•°çš„çŸ¥è¯†ã€‚æˆ‘å¸Œæœ›è¯»å®Œè¿™ç¯‡æ–‡ç« åï¼Œä½ èƒ½å¤Ÿå›ç­”ä»¥ä¸‹é—®é¢˜:

*   LightGBM ä¸­å®ç°äº†å“ªäº›æ¢¯åº¦æå‡æ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
*   ä¸€èˆ¬æ¥è¯´ï¼Œå“ªäº›å‚æ•°æ˜¯é‡è¦çš„ï¼Ÿ
*   éœ€è¦è°ƒæ•´å“ªäº›æ­£åˆ™åŒ–å‚æ•°ï¼Ÿ
*   å¦‚ä½•åœ¨ python ä¸­è°ƒä¼˜ lightGBM å‚æ•°ï¼Ÿ

## æ¢¯åº¦æ¨è¿›æ–¹æ³•

ä½¿ç”¨ LightGBMï¼Œæ‚¨å¯ä»¥è¿è¡Œä¸åŒç±»å‹çš„æ¢¯åº¦å¢å¼ºæ–¹æ³•ã€‚æ‚¨æœ‰:GBDTã€è¾¾ç‰¹å’Œæˆˆæ–¯ï¼Œå®ƒä»¬å¯ä»¥ç”¨`boosting`å‚æ•°æ¥æŒ‡å®šã€‚

åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†è§£é‡Šå’Œæ¯”è¾ƒè¿™äº›æ–¹æ³•ã€‚

### **lgbm gbdt(æ¢¯åº¦å¢å¼ºå†³ç­–æ ‘)**

è¿™ç§æ–¹æ³•æ˜¯ä¼ ç»Ÿçš„æ¢¯åº¦æ¨è¿›å†³ç­–æ ‘ï¼Œåœ¨è¿™ç¯‡ [**æ–‡ç« **](https://web.archive.org/web/20230127191010/https://statweb.stanford.edu/~jhf/ftp/trebst.pdf) ä¸­é¦–æ¬¡æå‡ºï¼Œå¹¶ä¸”æ˜¯ XGBoost å’Œ pGBRT ç­‰ä¸€äº›ä¼Ÿå¤§åº“èƒŒåçš„ç®—æ³•ã€‚

å¦‚ä»Šï¼Œgbdt å› å…¶å‡†ç¡®æ€§ã€é«˜æ•ˆæ€§å’Œç¨³å®šæ€§è€Œè¢«å¹¿æ³›ä½¿ç”¨ã€‚ä½ å¯èƒ½çŸ¥é“ gbdt æ˜¯å†³ç­–æ ‘çš„é›†åˆæ¨¡å‹ï¼Œä½†æ˜¯å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

è®©æˆ‘ç»™ä½ ä¸€ä¸ªè¦ç‚¹ã€‚

å®ƒåŸºäºä¸‰ä¸ªé‡è¦åŸåˆ™:

*   å¼±å­¦ä¹ è€…(å†³ç­–æ ‘)
*   æ¢¯åº¦ä¼˜åŒ–
*   åŠ©æ¨æŠ€æœ¯

æ‰€ä»¥åœ¨ gbdt æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå†³ç­–æ ‘(å¼±å­¦ä¹ è€…)ã€‚è¿™äº›æ ‘æ˜¯æŒ‰é¡ºåºå»ºé€ çš„:

*   ç¬¬ä¸€æ£µæ ‘å­¦ä¹ å¦‚ä½•é€‚åº”ç›®æ ‡å˜é‡
*   ç¬¬äºŒæ£µæ ‘å­¦ä¹ å¦‚ä½•æ‹Ÿåˆç¬¬ä¸€æ£µæ ‘çš„é¢„æµ‹å’Œåœ°é¢çœŸå®å€¼ä¹‹é—´çš„æ®‹å·®(å·®å¼‚)
*   ç¬¬ä¸‰æ£µæ ‘å­¦ä¹ å¦‚ä½•æ‹Ÿåˆç¬¬äºŒæ£µæ ‘çš„æ®‹å·®ï¼Œä»¥æ­¤ç±»æ¨ã€‚

æ‰€æœ‰è¿™äº›æ ‘éƒ½æ˜¯é€šè¿‡åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ä¼ æ’­è¯¯å·®æ¢¯åº¦æ¥è®­ç»ƒçš„ã€‚

gbdt çš„ä¸»è¦ç¼ºç‚¹æ˜¯åœ¨æ¯ä¸ªæ ‘èŠ‚ç‚¹ä¸­å¯»æ‰¾[æœ€ä½³åˆ†è£‚ç‚¹](https://web.archive.org/web/20230127191010/https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree.pdf)æ˜¯è€—æ—¶ä¸”æ¶ˆè€—å†…å­˜çš„æ“ä½œã€‚å…¶ä»– boosting æ–¹æ³•è¯•å›¾è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### **é•–æ¢¯åº¦å¢å¼º**

åœ¨è¿™ç¯‡å‡ºè‰²çš„[è®ºæ–‡](https://web.archive.org/web/20230127191010/https://arxiv.org/abs/1505.01866)ä¸­ï¼Œæ‚¨å¯ä»¥äº†è§£å…³äº DART æ¢¯åº¦æå‡çš„æ‰€æœ‰äº‹æƒ…ï¼ŒDART æ¢¯åº¦æå‡æ˜¯ä¸€ç§ä½¿ç”¨ç¥ç»ç½‘ç»œä¸­çš„æ ‡å‡†ä¸‹é™æ¥æ”¹å–„æ¨¡å‹æ­£åˆ™åŒ–å¹¶å¤„ç†å…¶ä»–ä¸€äº›ä¸å¤ªæ˜æ˜¾çš„é—®é¢˜çš„æ–¹æ³•ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œgbdt é­å—è¿‡åº¦ç‰¹æ®ŠåŒ–ï¼Œè¿™æ„å‘³ç€åœ¨åé¢çš„è¿­ä»£ä¸­æ·»åŠ çš„æ ‘å¾€å¾€åªå½±å“å°‘æ•°å®ä¾‹çš„é¢„æµ‹ï¼Œè€Œå¯¹å…¶ä½™å®ä¾‹çš„è´¡çŒ®å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚æ·»åŠ  dropout ä¼šä½¿æ ‘åœ¨ä»¥åçš„è¿­ä»£ä¸­æ›´éš¾ä¸“æ³¨äºè¿™å‡ ä¸ªæ ·æœ¬ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚

### **lgbm goss(åŸºäºæ¢¯åº¦çš„å•ä¾§é‡‡æ ·)**

äº‹å®ä¸Šï¼Œå°†è¿™ç§æ–¹æ³•å‘½åä¸º lightgbm çš„æœ€é‡è¦åŸå› æ˜¯ä½¿ç”¨äº†åŸºäºè¿™ç¯‡[è®ºæ–‡](https://web.archive.org/web/20230127191010/https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree.pdf)çš„[Goss](https://web.archive.org/web/20230127191010/https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree.pdf)æ–¹æ³•ã€‚Goss æ˜¯æ›´æ–°æ›´è½»çš„ gbdt å®ç°(å› æ­¤æ˜¯â€œè½»â€gbm)ã€‚

æ ‡å‡†çš„ gbdt æ˜¯å¯é çš„ï¼Œä½†æ˜¯åœ¨å¤§å‹æ•°æ®é›†ä¸Šä¸å¤Ÿå¿«ã€‚å› æ­¤ï¼Œgoss æå‡ºäº†ä¸€ç§åŸºäºæ¢¯åº¦çš„é‡‡æ ·æ–¹æ³•ï¼Œä»¥é¿å…æœç´¢æ•´ä¸ªæœç´¢ç©ºé—´ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæ¯ä¸ªæ•°æ®å®ä¾‹ï¼Œå½“æ¢¯åº¦è¾ƒå°æ—¶ï¼Œè¿™æ„å‘³ç€ä¸ç”¨æ‹…å¿ƒæ•°æ®è®­ç»ƒè‰¯å¥½ï¼Œå½“æ¢¯åº¦è¾ƒå¤§æ—¶ï¼Œåº”è¯¥å†æ¬¡é‡æ–°è®­ç»ƒã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæœ‰**ä¸¤è¾¹**ï¼Œæœ‰å¤§æ¢¯åº¦å’Œå°æ¢¯åº¦çš„æ•°æ®å®ä¾‹ã€‚å› æ­¤ï¼Œgoss ä¿ç•™æ‰€æœ‰å…·æœ‰å¤§æ¢¯åº¦çš„æ•°æ®ï¼Œå¹¶å¯¹å…·æœ‰å°æ¢¯åº¦çš„æ•°æ®è¿›è¡Œéšæœºé‡‡æ ·(**ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºå•ä¾§é‡‡æ ·**)ã€‚è¿™ä½¿å¾—æœç´¢ç©ºé—´æ›´å°ï¼Œgoss å¯ä»¥æ›´å¿«åœ°æ”¶æ•›ã€‚æœ€åï¼Œä¸ºäº†è·å¾—æ›´å¤šå…³äºæˆˆæ–¯çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡[çš„åšæ–‡](https://web.archive.org/web/20230127191010/https://towardsdatascience.com/what-makes-lightgbm-lightning-fast-a27cf0d9785e)ã€‚

è®©æˆ‘ä»¬å°†è¿™äº›å·®å¼‚æ”¾åœ¨ä¸€ä¸ªè¡¨æ ¼ä¸­:

| æ–¹æ³• | æ³¨æ„ | éœ€è¦æ”¹å˜è¿™äº›å‚æ•° | ä¼˜åŠ¿ | ä¸è¶³ä¹‹å¤„ |
| --- | --- | --- | --- | --- |
|  | 

æ˜¯

çš„é»˜è®¤å¢å‹ç±»å‹ | 

å› ä¸º gbdt æ˜¯ lgbm çš„é»˜è®¤å‚æ•°ï¼Œæ‰€ä»¥æ‚¨ä¸å¿…ä¸ºå®ƒæ›´æ”¹å…¶ä½™å‚æ•°çš„å€¼(ä»ç„¶å¿…é¡»è¿›è¡Œè°ƒæ•´ï¼)

 |  | 

è¿‡åº¦ç‰¹æ®ŠåŒ–ï¼Œè€—æ—¶è€—åŠ›

 |
|  | 

è¯•å›¾è§£å†³ gbdt

ä¸­çš„è¿‡åº¦ä¸“ä¸šåŒ–é—®é¢˜ | 

drop_seed:ç”¨äºé€‰æ‹©ä¸¢å¼ƒæ¨¡å¼çš„éšæœºç§å­ sUniform_dro:å¦‚æœè¦ä½¿ç”¨ç»Ÿä¸€ä¸¢å¼ƒ xgboost_dart_mode:å¦‚æœè¦ä½¿ç”¨ xgboost dart æ¨¡å¼ï¼Œè¯·å°†å…¶è®¾ç½®ä¸º true skip _ drop:åœ¨æå‡è¿­ä»£æœŸé—´è·³è¿‡ä¸¢å¼ƒè¿‡ç¨‹çš„æ¦‚ç‡ max_dropdrop_rate:ä¸¢å¼ƒç‡:åœ¨ä¸¢å¼ƒè¿‡ç¨‹ä¸­è¦ä¸¢å¼ƒçš„å…ˆå‰æ ‘çš„åˆ†æ•°

 |  |  |
|  | 

æˆˆæ–¯é€šè¿‡åˆ†ç¦»é‚£äº›æ¢¯åº¦è¾ƒå¤§çš„å®ä¾‹ä¸º GBDT æä¾›äº†ä¸€ç§æ–°çš„é‡‡æ ·æ–¹æ³•

 | 

top_rate:å¤§æ¢¯åº¦æ•°æ®ä¿ç•™ç‡ other_rate:å°æ¢¯åº¦æ•°æ®ä¿ç•™ç‡

 |  | 

æ•°æ®é›†å°æ—¶è¿‡æ‹Ÿåˆ

 |

![](img/e26f9310772a1cfa52ddfe91020e2852.png)

å¦‚æœä½ è®¾ç½®æå‡ä¸º RFï¼Œé‚£ä¹ˆ lightgbm ç®—æ³•è¡¨ç°ä¸ºéšæœºæ£®æ—ï¼Œè€Œä¸æ˜¯æå‡çš„æ ‘ï¼æ ¹æ®æ–‡æ¡£ï¼Œè¦ä½¿ç”¨ RFï¼Œå¿…é¡»ä½¿ç”¨å°äº 1 çš„ bagging_fraction å’Œ feature_fractionã€‚

## æ­£è§„åŒ–

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†ä»‹ç» lightgbm çš„ä¸€äº›é‡è¦çš„æ­£åˆ™åŒ–å‚æ•°ã€‚æ˜¾ç„¶ï¼Œè¿™äº›æ˜¯æ‚¨éœ€è¦è°ƒæ•´ä»¥é˜²æ­¢è¿‡åº¦æ‹Ÿåˆçš„å‚æ•°ã€‚

æ‚¨åº”è¯¥çŸ¥é“ï¼Œå¯¹äºå°æ•°æ®é›†(< 10000 æ¡è®°å½•)ï¼ŒlightGBM å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚è°ƒä¼˜ lightgbm å‚æ•°å¯èƒ½å¯¹æ‚¨æ²¡æœ‰å¸®åŠ©ã€‚

æ­¤å¤–ï¼Œlightgbm ä½¿ç”¨[é€å¶](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Features.html#leaf-wise-best-first-tree-growth)æ ‘ç”Ÿé•¿ç®—æ³•ï¼Œè€Œ eXGBoost ä½¿ç”¨æ·±åº¦æ ‘ç”Ÿé•¿ç®—æ³•ã€‚é€å¶æ–¹æ³•å…è®¸æ ‘æ›´å¿«åœ°æ”¶æ•›ï¼Œä½†æ˜¯è¿‡åº¦æ‹Ÿåˆçš„æœºä¼šå¢åŠ äº†ã€‚

ä¹Ÿè®¸è¿™ä¸ªæ¥è‡ª PyData ä¼šè®®çš„[æ¼”è®²ç»™äº†ä½ æ›´å¤šå…³äº Xgboost å’Œ Lightgbm çš„è§è§£ã€‚å€¼å¾—ä¸€çœ‹ï¼](https://web.archive.org/web/20230127191010/https://youtu.be/5CWwwtEM2TA)

[https://web.archive.org/web/20230127191010if_/https://www.youtube.com/embed/5CWwwtEM2TA?feature=oembed](https://web.archive.org/web/20230127191010if_/https://www.youtube.com/embed/5CWwwtEM2TA?feature=oembed)

è§†é¢‘

![](img/e26f9310772a1cfa52ddfe91020e2852.png)

å¦‚æœæœ‰äººé—®ä½  LightGBM å’Œ XGBoost çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°è¯´ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºå®ƒä»¬æ˜¯å¦‚ä½•å®ç°çš„ã€‚

æ ¹æ® [lightGBM æ–‡æ¡£](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html#deal-with-over-fitting)ï¼Œå½“é¢ä¸´è¿‡æ‹Ÿåˆæ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›è¿›è¡Œä»¥ä¸‹å‚æ•°è°ƒæ•´:

*   ä½¿ç”¨å° max_bin
*   ä½¿ç”¨å°æ•°é‡çš„å¶å­
*   ä½¿ç”¨å¶ä¸­æœ€å°æ•°æ®å’Œå¶ä¸­æœ€å°å’Œ
*   é€šè¿‡è®¾ç½® bagging_fraction å’Œ bagging_freq æ¥ä½¿ç”¨ bagging
*   é€šè¿‡è®¾ç½® feature_fraction ä½¿ç”¨ç‰¹å¾å­é‡‡æ ·
*   ä½¿ç”¨æ›´å¤§çš„è®­ç»ƒæ•°æ®
*   å°è¯• lambda_l1ã€lambda_l2 å’Œ min_gain_to_split è¿›è¡Œæ­£åˆ™åŒ–
*   å°è¯• max_depth ä»¥é¿å…æ ‘è¶Šé•¿è¶Šæ·±

åœ¨æ¥ä¸‹æ¥çš„å‡ èŠ‚ä¸­ï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è§£é‡Šè¿™äº›å‚æ•°ã€‚

### **Î»_ L1**

Lambda_l1(å’Œ lambda_l2)æ§åˆ¶åˆ° l1/l2ï¼Œå¹¶ä¸ min_gain_to_split ä¸€èµ·ç”¨äºå¯¹æŠ—**è¿‡æ‹Ÿåˆ**ã€‚æˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨å‚æ•°è°ƒæ•´(åœ¨åé¢çš„å°èŠ‚ä¸­æ¢è®¨)æ¥æ‰¾å‡ºè¿™äº›å‚æ•°çš„æœ€ä½³å€¼ã€‚

### **å¶å­æ•°é‡**

å½“ç„¶ **num_leaves** æ˜¯æ§åˆ¶æ¨¡å‹çš„**å¤æ‚åº¦**çš„æœ€é‡è¦å‚æ•°ä¹‹ä¸€ã€‚ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥è®¾ç½®æ¯ä¸ªå¼±å­¦ä¹ è€…æ‹¥æœ‰çš„æœ€å¤§å¶ç‰‡æ•°ã€‚è¾ƒå¤§çš„ num_leaves å¢åŠ äº†è®­ç»ƒé›†çš„å‡†ç¡®æ€§ï¼Œä¹Ÿå¢åŠ äº†å› è¿‡åº¦è®­ç»ƒè€Œå—ä¼¤çš„æœºä¼šã€‚æ ¹æ®æ–‡æ¡£ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ **num_leaves = 2^(max_depth)** ç„¶è€Œï¼Œè€ƒè™‘åˆ°åœ¨ lightgbm ä¸­ï¼Œé€å¶æ ‘æ¯”é€å±‚æ ‘æ›´æ·±ï¼Œä½ éœ€è¦å°å¿ƒè¿‡åº¦æ‹Ÿåˆï¼**å› æ­¤ï¼Œæœ‰å¿…è¦å°†** **num_leaves** **ä¸** **max_depth** **ä¸€èµ·è°ƒã€‚**

### **å­æ ·æœ¬**

ä½¿ç”¨[å­æ ·æœ¬](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Parameters.html#learning-control-parameters)(æˆ– bagging_fraction)ï¼Œæ‚¨å¯ä»¥æŒ‡å®šæ¯ä¸ªæ ‘æ„å»ºè¿­ä»£ä¸­ä½¿ç”¨çš„è¡Œçš„ç™¾åˆ†æ¯”ã€‚è¿™æ„å‘³ç€å°†éšæœºé€‰æ‹©ä¸€äº›è¡Œæ¥é€‚åº”æ¯ä¸ªå­¦ä¹ è€…(æ ‘)ã€‚è¿™ä¸ä»…æé«˜äº†æ³›åŒ–èƒ½åŠ›ï¼Œè¿˜æé«˜äº†è®­ç»ƒé€Ÿåº¦ã€‚

æˆ‘å»ºè®®å¯¹åŸºçº¿æ¨¡å‹ä½¿ç”¨è¾ƒå°çš„å­æ ·æœ¬å€¼ï¼Œç„¶ååœ¨å®Œæˆå…¶ä»–å®éªŒæ—¶å¢åŠ è¿™ä¸ªå€¼(ä¸åŒçš„ç‰¹å¾é€‰æ‹©ï¼Œä¸åŒçš„æ ‘ç»“æ„)ã€‚

### **ç‰¹å¾ _ åˆ†æ•°**

[Feature fraction](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Parameters.html#learning-control-parameters) æˆ– sub_feature å¤„ç†åˆ—é‡‡æ ·ï¼ŒLightGBM å°†åœ¨æ¯æ¬¡è¿­ä»£(æ ‘)ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªç‰¹å¾å­é›†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º 0.6ï¼ŒLightGBM å°†åœ¨è®­ç»ƒæ¯æ£µæ ‘ä¹‹å‰é€‰æ‹© 60%çš„ç‰¹å¾ã€‚

è¯¥åŠŸèƒ½æœ‰ä¸¤ç§ç”¨æ³•:

*   å¯ä»¥ç”¨æ¥åŠ é€Ÿè®­ç»ƒ
*   å¯ä»¥ç”¨æ¥å¤„ç†è¿‡åº¦æ‹Ÿåˆ

### **æœ€å¤§æ·±åº¦**

è¯¥å‚æ•°æ§åˆ¶æ¯ä¸ªè®­ç»ƒæ ‘çš„æœ€å¤§æ·±åº¦ï¼Œå¹¶å°†å½±å“:

*   num_leaves å‚æ•°çš„æœ€ä½³å€¼
*   æ¨¡å‹æ€§èƒ½
*   è®­ç»ƒæ—¶é—´

è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨è¾ƒå¤§çš„å€¼ **max_depth** ï¼Œæ‚¨çš„æ¨¡å‹å°†å¾ˆå¯èƒ½**è¿‡åº¦é€‚åˆ**åˆ—è½¦ç»„ã€‚

### **max_bin**

å®æ»¨æ˜¯ä¸€ç§åœ¨ç¦»æ•£è§†å›¾(ç›´æ–¹å›¾)ä¸­è¡¨ç¤ºæ•°æ®çš„æŠ€æœ¯ã€‚Lightgbm ä½¿ç”¨åŸºäºç›´æ–¹å›¾çš„ç®—æ³•æ¥å¯»æ‰¾æœ€ä½³åˆ†å‰²ç‚¹ï¼ŒåŒæ—¶åˆ›å»ºå¼±å­¦ä¹ å™¨ã€‚å› æ­¤ï¼Œæ¯ä¸ªè¿ç»­çš„æ•°å­—ç‰¹å¾(ä¾‹å¦‚ï¼Œè§†é¢‘çš„è§‚çœ‹æ¬¡æ•°)åº”è¯¥è¢«åˆ†æˆç¦»æ•£çš„ç®±ã€‚

è¿˜æœ‰ï¼Œåœ¨è¿™ä¸ª [GitHub r](https://web.archive.org/web/20230127191010/https://github.com/szilard/GBM-perf) epo é‡Œï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€äº›å…¨é¢çš„å®éªŒï¼Œå®Œæ•´çš„è§£é‡Šäº†æ”¹å˜ max_bin å¯¹ CPU å’Œ GPU çš„å½±å“ã€‚

å¦‚æœå°† max_bin å®šä¹‰ä¸º 255ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªç‰¹æ€§æœ€å¤šå¯ä»¥æœ‰ 255 ä¸ªå”¯ä¸€å€¼ã€‚é‚£ä¹ˆå°çš„ max_bin å¯¼è‡´æ›´å¿«çš„é€Ÿåº¦ï¼Œå¤§çš„å€¼æé«˜ç²¾åº¦ã€‚

## è®­ç»ƒå‚æ•°

è®­ç»ƒæ—¶é—´ï¼å½“æ‚¨å¸Œæœ›ä½¿ç”¨ lightgbm è®­ç»ƒæ¨¡å‹æ—¶ï¼Œè®­ç»ƒ lightgbm æ¨¡å‹æ—¶å¯èƒ½å‡ºç°çš„ä¸€äº›å…¸å‹é—®é¢˜æ˜¯:

*   åŸ¹è®­æ˜¯ä¸€ä¸ªè€—æ—¶çš„è¿‡ç¨‹
*   å¤„ç†è®¡ç®—å¤æ‚æ€§(CPU/GPU RAM é™åˆ¶)
*   å¤„ç†åˆ†ç±»ç‰¹å¾
*   æ‹¥æœ‰ä¸å¹³è¡¡çš„æ•°æ®é›†
*   å¯¹å®šåˆ¶æŒ‡æ ‡çš„éœ€æ±‚
*   åˆ†ç±»æˆ–å›å½’é—®é¢˜éœ€è¦è¿›è¡Œçš„è°ƒæ•´

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•è¯¦ç»†è§£é‡Šè¿™äº›è¦ç‚¹ã€‚

### **è¿­ä»£æ¬¡æ•°**

Num_iterations æŒ‡å®šæå‡è¿­ä»£çš„æ¬¡æ•°(è¦æ„å»ºçš„æ ‘)ã€‚æ„å»ºçš„æ ‘è¶Šå¤šï¼Œæ¨¡å‹å°±è¶Šç²¾ç¡®ï¼Œä»£ä»·æ˜¯:

*   æ›´é•¿çš„è®­ç»ƒæ—¶é—´
*   è¿‡åº¦æ‹Ÿåˆçš„å¯èƒ½æ€§æ›´é«˜

ä»è¾ƒä½æ•°é‡çš„æ ‘å¼€å§‹æ„å»ºåŸºçº¿ï¼Œç¨åå½“æ‚¨æƒ³è¦ä»æ¨¡å‹ä¸­æŒ¤å‡ºæœ€åçš„%æ—¶ï¼Œå¢åŠ åŸºçº¿ã€‚

å»ºè®®ä½¿ç”¨è¾ƒå°çš„**å­¦ä¹ é€Ÿç‡**å’Œè¾ƒå¤§çš„**æ¬¡æ•°è¿­ä»£**ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ çš„è®­ç»ƒæ²¡æœ‰å­¦åˆ°ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ï¼Œä½ åº”è¯¥ä½¿ç”¨ early_stopping_rounds æ¥åœæ­¢ä½ çš„è®­ç»ƒã€‚

### **æå‰ _ åœæ­¢ _ å›åˆ**

å¦‚æœéªŒè¯æŒ‡æ ‡åœ¨æœ€åä¸€è½®æå‰åœæ­¢åæ²¡æœ‰æ”¹å–„ï¼Œè¯¥å‚æ•°å°†åœæ­¢**è®­ç»ƒ**ã€‚è¿™åº”è¯¥ä¸è¿­ä»£æ¬¡æ•°çš„**æˆå¯¹å®šä¹‰ã€‚å¦‚æœä½ è®¾ç½®çš„å¤ªå¤§ï¼Œä½ ä¼šå¢åŠ **è¿‡åº¦æ‹Ÿåˆ**çš„æœºä¼š(ä½†æ˜¯ä½ çš„æ¨¡å‹å¯ä»¥æ›´å¥½)ã€‚**

ç»éªŒæ³•åˆ™æ˜¯åœ¨ num_iterations çš„ 10%æ—¶ä½¿ç”¨å®ƒã€‚

### **light GBM category _ feature**

ä½¿ç”¨ lightgbm çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®ƒå¯ä»¥å¾ˆå¥½åœ°å¤„ç†åˆ†ç±»ç‰¹å¾ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªç®—æ³•éå¸¸å¼ºå¤§ï¼Œä½†æ˜¯ä½ å¿…é¡»å°å¿ƒä½¿ç”¨å®ƒçš„å‚æ•°ã€‚lightgbm ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„[](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Features.html#optimal-split-for-categorical-features)**æ•´æ•°ç¼–ç æ–¹æ³•(ç”± [**è´¹å¸Œå°”**](https://web.archive.org/web/20230127191010/http://www.csiss.org/SPACE/workshops/2004/SAC/files/fisher.pdf) æå‡º)æ¥å¤„ç†åˆ†ç±»ç‰¹å¾**

 **å®éªŒè¡¨æ˜ï¼Œè¯¥æ–¹æ³•æ¯”å¸¸ç”¨çš„**ä¸€é”®ç¼–ç **å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚

å®ƒçš„ç¼ºçœå€¼æ˜¯â€œauto â€,è¿™æ„å‘³ç€:è®© lightgbm å†³å®šå“ªä¸ªæ„å‘³ç€ lightgbm å°†æ¨æ–­å“ªäº›ç‰¹å¾æ˜¯åˆ†ç±»çš„ã€‚

å®ƒå¹¶ä¸æ€»æ˜¯å·¥ä½œå¾—å¾ˆå¥½(ä¸€äº›å®éªŒæ˜¾ç¤ºäº†ä¸ºä»€ä¹ˆè¿™é‡Œçš„[å’Œè¿™é‡Œçš„](https://web.archive.org/web/20230127191010/https://www.kaggle.com/mlisovyi/beware-of-categorical-features-in-lgbm)å’Œ[å’Œ](https://web.archive.org/web/20230127191010/https://www.kaggle.com/c/home-credit-default-risk/discussion/58950))æˆ‘å¼ºçƒˆå»ºè®®ä½ ç®€å•åœ°ç”¨è¿™æ®µä»£ç æ‰‹åŠ¨è®¾ç½®[åˆ†ç±»ç‰¹å¾](https://web.archive.org/web/20230127191010/https://www.kaggle.com/mlisovyi/beware-of-categorical-features-in-lgbm#339301)

**cat _ col = dataset _ name . select _ dtypes(' object '). columns . to list()**

ä½†æ˜¯å¹•åå‘ç”Ÿäº†ä»€ä¹ˆï¼Œlightgbm å¦‚ä½•å¤„ç†åˆ†ç±»ç‰¹æ€§ï¼Ÿ

æ ¹æ® lightgbm çš„ [**æ–‡æ¡£**](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/Features.html#optimal-split-for-categorical-features) ï¼Œæˆ‘ä»¬çŸ¥é“æ ‘å­¦ä¹ è€…ä¸èƒ½å¾ˆå¥½åœ°ä½¿ç”¨ä¸€ç§çƒ­ç¼–ç æ–¹æ³•ï¼Œå› ä¸ºä»–ä»¬é€šè¿‡æ ‘æ·±å…¥ç”Ÿé•¿ã€‚åœ¨æ‰€æå‡ºçš„æ›¿ä»£æ–¹æ³•ä¸­ï¼Œæ ‘å­¦ä¹ å™¨è¢«æœ€ä½³åœ°æ„é€ ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå…·æœ‰ k ä¸ªä¸åŒç±»åˆ«çš„ä¸€ä¸ªç‰¹å¾ï¼Œå­˜åœ¨ 2^(k-1)-1 ä¸ªå¯èƒ½çš„åˆ†åŒºï¼Œå¹¶ä¸”ä½¿ç”¨ [fisher](https://web.archive.org/web/20230127191010/http://www.csiss.org/SPACE/workshops/2004/SAC/files/fisher.pdf) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥é€šè¿‡åœ¨åˆ†ç±»ç‰¹å¾ä¸­çš„å€¼çš„æ’åºç›´æ–¹å›¾ä¸Šæ‰¾åˆ°æœ€ä½³åˆ†å‰²æ–¹å¼æ¥æ”¹è¿›ä¸º **k * log(k)** ã€‚

### **light GBM is _ unbalance vs scale _ pos _ weight**

åœ¨**äºŒå…ƒåˆ†ç±»é—®é¢˜**ä¸­ä½ å¯èƒ½é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•å¤„ç†**ä¸å¹³è¡¡**æ•°æ®é›†ã€‚æ˜¾ç„¶ï¼Œæ‚¨éœ€è¦å¹³è¡¡æ­£/è´Ÿæ ·æœ¬ï¼Œä½†æ˜¯åœ¨ lightgbm ä¸­æ‚¨å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ

lightgbm ä¸­æœ‰ä¸¤ä¸ªå‚æ•°å¯ä»¥è®©ä½ å¤„ç†è¿™ä¸ªé—®é¢˜ **is_unbalance å’Œ scale_pos_weight** ï¼Œä½†æ˜¯å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿ

*   å½“æ‚¨è®¾ç½® Is _ un lace:True æ—¶ï¼Œç®—æ³•å°†å°è¯•è‡ªåŠ¨å¹³è¡¡å—æ”¯é…æ ‡ç­¾çš„æƒé‡(ä½¿ç”¨è®­ç»ƒé›†ä¸­çš„æ­£/è´Ÿåˆ†æ•°)
*   å¦‚æœæ‚¨æƒ³è¦åœ¨ä¸å¹³è¡¡æ•°æ®é›†çš„æƒ…å†µä¸‹æ›´æ”¹ **scale_pos_weight** (é»˜è®¤ä¸º 1ï¼Œè¿™æ„å‘³ç€å‡è®¾æ­£è´Ÿæ ‡ç­¾ç›¸ç­‰)ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…¬å¼(åŸºäº lightgbm å­˜å‚¨åº“ä¸Šçš„è¿™ä¸ª[é—®é¢˜](https://web.archive.org/web/20230127191010/https://github.com/microsoft/LightGBM/issues/1299))æ¥æ­£ç¡®è®¾ç½®å®ƒ

**æ ·æœ¬ä½ç½®æƒé‡=é˜´æ€§æ ·æœ¬æ•°/é˜³æ€§æ ·æœ¬æ•°**

### **lgbm feval**

æœ‰æ—¶ä½ æƒ³è¦å®šä¹‰ä¸€ä¸ªå®šåˆ¶çš„è¯„ä¼°å‡½æ•°æ¥æµ‹é‡ä½ çš„æ¨¡å‹çš„æ€§èƒ½ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª`feval`å‡½æ•°ã€‚

**Feval å‡½æ•°**åº”è¯¥æ¥å—ä¸¤ä¸ªå‚æ•°:

å¹¶è¿”å›

*   è¯„ä¼°åç§°
*   è¯„ä¼°ç»“æœ
*   è¶Šé«˜è¶Šå¥½å—

è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°åˆ›å»ºä¸€ä¸ªå®šåˆ¶çš„åº¦é‡å‡½æ•°ã€‚

å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„ python å‡½æ•°

ä½¿ç”¨æ­¤å‡½æ•°ä½œä¸ºå‚æ•°:

```py
def feval_func(preds, train_data):

    return ('feval_func_name', eval_result, False)
```

è¦ä½¿ç”¨ feval å‡½æ•°è€Œä¸æ˜¯å…¬åˆ¶ï¼Œæ‚¨åº”è¯¥è®¾ç½®å…¬åˆ¶å‚æ•°â€œæ— â€ã€‚

```py
print('Start training...')
lgb_train = lgb.train(...,
                      metric=None,
                      feval=feval_func)
```

![](img/e26f9310772a1cfa52ddfe91020e2852.png)

**åˆ†ç±»å‚æ•°ä¸å›å½’å‚æ•°**

### æˆ‘ä¹‹å‰æåˆ°çš„å¤§å¤šæ•°äº‹æƒ…å¯¹äºåˆ†ç±»å’Œå›å½’éƒ½æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æœ‰äº›äº‹æƒ…éœ€è¦è°ƒæ•´ã€‚

å…·ä½“æ¥è¯´ï¼Œæ‚¨åº”è¯¥:

å‚æ•°çš„åç§°

| åˆ†ç±»è¯´æ˜ | å›å½’æ³¨é‡Š |  |
| --- | --- | --- |
| 

è®¾ç½®ä¸ºäºŒè¿›åˆ¶æˆ–å¤šç±»

 | å°†å…¶è®¾ç½®ä¸ºäºŒè¿›åˆ¶æˆ–å¤šç±» |  |
| 

Binary_logloss æˆ– AUC ç­‰ã€‚

 | Binary_logloss æˆ– AUC æˆ– etcã€‚ | RMSE æˆ–å¹³å‡ç»å¯¹è¯¯å·®å’Œæˆ–ç­‰ã€‚ |
|  |  |  |
| 

ä»…ç”¨äºäºŒè¿›åˆ¶å’Œå¤šç±»åº”ç”¨

 | ä»…ç”¨äºäºŒè¿›åˆ¶å’Œå¤šç±»åº”ç”¨ |  |
| 

ä»…åœ¨å¤šç±»åˆ†ç±»åº”ç”¨ä¸­ä½¿ç”¨

 | ä»…ç”¨äºå¤šç±»åˆ†ç±»åº”ç”¨ |  |
|  | 

ç”¨äºæ‹Ÿåˆ sqrt(æ ‡ç­¾)ä»£æ›¿åŸå§‹å€¼ç”¨äºå¤§èŒƒå›´æ ‡ç­¾

 | ç”¨äºæ‹Ÿåˆ sqrt(æ ‡ç­¾),è€Œä¸æ˜¯å¤§èŒƒå›´æ ‡ç­¾çš„åŸå§‹å€¼ |

## åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å›é¡¾å¹¶äº†è§£äº†ä¸€äº›å…³äº lightgbm å‚æ•°çš„çŸ¥è¯†ï¼Œä½†æ˜¯å¦‚æœä¸æåˆ° Laurae çš„ä»¤äººéš¾ä»¥ç½®ä¿¡çš„åŸºå‡†æµ‹è¯•ï¼Œä»»ä½•ä¸€ç¯‡å…³äº boosted trees çš„æ–‡ç« éƒ½æ˜¯ä¸å®Œæ•´çš„ğŸ™‚

æ‚¨å¯ä»¥äº†è§£ lightGBM å’Œ XGBoost çš„è®¸å¤šé—®é¢˜çš„æœ€ä½³ç¼ºçœå‚æ•°ã€‚

ä½ å¯ä»¥[ç‚¹å‡»è¿™é‡Œ](https://web.archive.org/web/20230127191010/https://sites.google.com/view/lauraepp/parameters)æŸ¥çœ‹ï¼Œä½†æœ€é‡è¦çš„å‡ ç‚¹æ˜¯:

å‚æ•°åç§°

| é»˜è®¤å€¼ | èŒƒå›´ | å‚æ•°ç±»å‹ | åˆ«å | çº¦æŸæˆ–æ³¨é‡Š | ç”¨äº |  |
| --- | --- | --- | --- | --- | --- | --- |
|  |  |  |  | 

å½“ä½ æ”¹å˜å®ƒæ—¶ä¼šå½±å“å…¶ä»–å‚æ•°

 | å½“ä½ æ”¹å˜å®ƒæ—¶ä¼šå½±å“å…¶ä»–å‚æ•° | æŒ‡å®š ML æ¨¡å‹çš„ç±»å‹ |
|  |  |  |  | 

ç©ºè¡¨ç¤ºå°†ä½¿ç”¨æŒ‡å®šç›®æ ‡å¯¹åº”çš„åº¦é‡

 | ç©ºè¡¨ç¤ºå°†ä½¿ç”¨ä¸æŒ‡å®šç›®æ ‡ç›¸å¯¹åº”çš„æŒ‡æ ‡ | æŒ‡å®šæŒ‡æ ‡ï¼Œæ”¯æŒå¤šä¸ªæŒ‡æ ‡ |
|  |  |  |  | 

å¦‚æœè®¾ç½®ä¸º RFï¼Œé‚£å°†æ˜¯ä¸€ä¸ªè£…è¢‹æ–¹å¼

 | å¦‚æœè®¾ç½®ä¸º RFï¼Œè¿™å°†æ˜¯ä¸€ç§æ‰“åŒ…æ–¹æ³• |  |
|  |  |  |  |  |  |  |
|  |  |  |  | 

0.0 <å¥—è¢‹ _ åˆ†æ•°<= 1.0

 | 0.0 <å¥—è¢‹ _ åˆ†æ•°< = 1.0 | éšæœºé€‰æ‹©éƒ¨åˆ†æ•°æ®ï¼Œæ— éœ€é‡é‡‡æ · |
|  |  |  |  | 

è¦å¯ç”¨ baggingï¼Œbagging_fraction ä¹Ÿè¦è®¾ç½®æˆå°äº 1.0 çš„å€¼

 | ä¸ºäº†å¯ç”¨ baggingï¼Œbagging_fraction ä¹Ÿåº”è®¾ç½®ä¸ºå°äº 1.0 çš„å€¼ | 0 è¡¨ç¤ºç¦ç”¨è£…è¢‹ï¼›k è¡¨ç¤ºæ¯ k æ¬¡è¿­ä»£è¿›è¡Œæ‰“åŒ… |
|  |  |  |  |  | 

ä¸€æ£µæ ‘çš„æœ€å¤§å¶å­æ•°

 | ä¸€æ£µæ ‘çš„æœ€å¤§å¶å­æ•° |
|  |  |  |  | 

0.0 <ç‰¹å¾ _ åˆ†æ•°<= 1.0

 | 0.0 <ç‰¹å¾ _ åˆ†æ•°< = 1.0 | å¦‚æœè®¾ç½®ä¸º 0.8ï¼ŒLightGBM å°†é€‰æ‹© 80%çš„åŠŸèƒ½ |
|  |  |  |  | 

é€šå¸¸è¶Šå¤§è¶Šå¥½ï¼Œä½†æ˜¯è¿‡æ‹Ÿåˆé€Ÿåº¦ä¼šå¢åŠ 

 | é€šå¸¸è¶Šå¤§è¶Šå¥½ï¼Œä½†æ˜¯è¿‡åº¦æ‹Ÿåˆé€Ÿåº¦ä¼šå¢åŠ  | é™åˆ¶æ ‘æ¨¡å‹çš„æœ€å¤§æ·±åº¦ |
|  |  |  |  |  |  |  |
|  |  |  |  |  | 

åŠ©æ¨è¿­ä»£æ¬¡æ•°

 | å‡å‹è¿­ä»£æ¬¡æ•° |
|  |  |  |  | 

å­¦ä¹ ç‡>0.0 å…¸å‹å€¼:0.05

 | å­¦ä¹ ç‡>0.0 å…¸å‹å€¼:0.05 | åœ¨ dart ä¸­ï¼Œå®ƒä¹Ÿå½±å“æ‰è½æ ‘æœ¨çš„å½’ä¸€åŒ–æƒé‡ |
|  |  |  |  | 

å¦‚æœæœ€åä¸€æ¬¡éªŒè¯æ²¡æœ‰æ”¹å–„ï¼Œå°†åœæ­¢è®­ç»ƒ _ åœæ­¢

_ å›åˆ

 | å¦‚æœéªŒè¯åœ¨æœ€è¿‘ä¸€æ¬¡æå‰åœæ­¢ä¸­æ²¡æœ‰æ”¹å–„ï¼Œå°†åœæ­¢åŸ¹è®­ | æ¨¡å‹æ€§èƒ½ã€è¿­ä»£æ¬¡æ•°ã€è®­ç»ƒæ—¶é—´ |
|  | 

æŒ‡å®šæŸä¸€åˆ—çš„ç¼–å·æŒ‡æ ‡

 | ä¸ºåˆ—ç´¢å¼•æŒ‡å®šä¸€ä¸ªæ•°å­— |  |  | 

å¤„ç†åˆ†ç±»ç‰¹å¾

 | å¤„ç†åˆ†ç±»ç‰¹å¾ |
|  |  |  |  | 

0 è¡¨ç¤ºç¦ç”¨è£…è¢‹ï¼›k è¡¨ç¤ºæ¯ k æ¬¡è¿­ä»£è¿›è¡Œæ‰“åŒ…

 | 0 è¡¨ç¤ºç¦ç”¨è£…è¢‹ï¼›k è¡¨ç¤ºæ¯ k æ¬¡è¿­ä»£è¿›è¡Œæ‰“åŒ… | ä¸ºäº†å¯ç”¨ baggingï¼Œbagging_fraction ä¹Ÿåº”è®¾ç½®ä¸ºå°äº 1.0 çš„å€¼ |
|  |  |  |  | 

< 0:è‡´å‘½ï¼Œ= 0:é”™è¯¯(è­¦å‘Š)ï¼Œ= 1:ä¿¡æ¯ï¼Œ> 1:è°ƒè¯•

 | < 0:è‡´å‘½ï¼Œ= 0:é”™è¯¯(è­¦å‘Š)ï¼Œ= 1:ä¿¡æ¯ï¼Œ> 1:è°ƒè¯• |  |
|  |  |  |  |  | 

å¯ä»¥ç”¨æ¥å¤„ç†è¿‡æ‹Ÿåˆ

 | å¯ç”¨äºå¤„ç†è¿‡æ‹Ÿåˆ |

ä½ ä¸åº”è¯¥è®¤ä¸ºä»»ä½•å‚æ•°å€¼æ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œå¹¶æ ¹æ®ä½ çš„é—®é¢˜æ¥è°ƒæ•´å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›å‚æ•°æ˜¯æ‚¨çš„è¶…å‚æ•°è°ƒæ•´ç®—æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹

![](img/e26f9310772a1cfa52ddfe91020e2852.png)

python ä¸­çš„ Lightgbm å‚æ•°è°ƒä¼˜ç¤ºä¾‹(lightgbm è°ƒä¼˜)

## æœ€åï¼Œåœ¨è§£é‡Šå®Œæ‰€æœ‰é‡è¦å‚æ•°ä¹‹åï¼Œæ˜¯æ—¶å€™è¿›è¡Œä¸€äº›å®éªŒäº†ï¼

æˆ‘å°±ç”¨ä¸€ä¸ªæµè¡Œçš„ Kaggle æ¯”èµ›:[æ¡‘å¦å¾·å®¢æˆ·äº¤æ˜“é¢„æµ‹](https://web.archive.org/web/20230127191010/https://www.kaggle.com/c/santander-customer-transaction-prediction/data)ã€‚

æˆ‘å°†ä½¿ç”¨è¿™ç¯‡æ–‡ç« è§£é‡Šå¦‚ä½•åœ¨ä»»ä½•è„šæœ¬ä¸Šè¿è¡Œ Python ä¸­çš„è¶…å‚æ•°è°ƒä¼˜ã€‚

å€¼å¾—ä¸€è¯»ï¼

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼æˆ‘ä»¬åº”è¯¥è°ƒæ•´å“ªäº›å‚æ•°ï¼Ÿ

æ³¨æ„æ‚¨æƒ³è¦è§£å†³çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼ŒSantander æ•°æ®é›†**é«˜åº¦ä¸å¹³è¡¡**ï¼Œåœ¨æ‚¨çš„è°ƒä¼˜ä¸­åº”è¯¥è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼ [Laurae2](https://web.archive.org/web/20230127191010/https://github.com/Laurae2) ï¼Œlightgbm çš„è´¡çŒ®è€…ä¹‹ä¸€[åœ¨è¿™é‡Œ](https://web.archive.org/web/20230127191010/https://github.com/microsoft/LightGBM/issues/695#issuecomment-315591634)å¾ˆå¥½çš„è§£é‡Šäº†è¿™ä¸€ç‚¹ã€‚

*   æœ‰äº›å‚æ•°æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œå¿…é¡»ä¸€èµ·è°ƒæ•´æˆ–é€ä¸ªè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œmin_data_in_leaf å–å†³äºè®­ç»ƒæ ·æœ¬çš„æ•°é‡å’Œ num _ leafã€‚
*   æ³¨æ„:æœ€å¥½ä¸ºè¶…å‚æ•°åˆ›å»ºä¸¤ä¸ªå­—å…¸ï¼Œä¸€ä¸ªåŒ…å«æ‚¨ä¸æƒ³ä¼˜åŒ–çš„å‚æ•°å’Œå€¼ï¼Œå¦ä¸€ä¸ªåŒ…å«æ‚¨æƒ³è¦ä¼˜åŒ–çš„å‚æ•°å’Œå€¼èŒƒå›´ã€‚

é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å¯ä»¥å°†åŸºçº¿å€¼ä»æœç´¢ç©ºé—´ä¸­åˆ†ç¦»å‡ºæ¥ï¼

```py
SEARCH_PARAMS = {'learning_rate': 0.4,
                 'max_depth': 15,
                 'num_leaves': 20,
                 'feature_fraction': 0.8,
                 'subsample': 0.2}

FIXED_PARAMS={'objective': 'binary',
              'metric': 'auc',
              'is_unbalance':True,
              'boosting':'gbdt',
              'num_boost_round':300,
              'early_stopping_rounds':30}
```

ç°åœ¨ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ [**ç¬”è®°æœ¬**](https://web.archive.org/web/20230127191010/https://app.neptune.ai/mjbahmani/LightGBM-hyperparameters/notebooks?notebookId=Some-experiments-based-on-lightgbm-1-dc193057-c63d-41a3-9144-eb1759e5b8f9) ä¸­ç”Ÿæˆä»£ç ã€‚å®ƒæ˜¯å…¬å¼€çš„ï¼Œä½ å¯ä»¥**ä¸‹è½½ã€‚**

1.  ç¬¬äºŒï¼Œæˆ‘ä»¬åœ¨ [**neptune.ai**](/web/20230127191010/https://neptune.ai/) ä¸­è·Ÿè¸ªæ¯ä¸ªå®éªŒçš„ç»“æœã€‚ä½ å¯ä»¥[åœ¨åº”ç”¨](https://web.archive.org/web/20230127191010/https://app.neptune.ai/mjbahmani/LightGBM-hyperparameters/experiments?split=tbl&dash=charts&viewId=standard-view)ä¸­çœ‹åˆ°è¿™ä¸ªä¾‹å­ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä½œä¸ºå…¬å…±é¡¹ç›®åˆ›å»ºçš„ã€‚

2.  æŸ¥çœ‹æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šå…³äºä½¿ç”¨ [Neptune-LightGBM é›†æˆ](https://web.archive.org/web/20230127191010/https://docs.neptune.ai/integrations/lightgbm/)è·Ÿè¸ªæ¨¡å‹æ„å»ºå…ƒæ•°æ®çš„ä¿¡æ¯ã€‚

**ç»“æœåˆ†æ**

### å¦‚æœæ‚¨å·²ç»æ£€æŸ¥äº†å‰é¢çš„éƒ¨åˆ†ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°æˆ‘å·²ç»åœ¨æ•°æ®é›†ä¸Šåšäº†è¶…è¿‡ 14 ä¸ªä¸åŒçš„å®éªŒã€‚åœ¨è¿™é‡Œï¼Œæˆ‘è§£é‡Šå¦‚ä½•ä¸€æ­¥ä¸€æ­¥åœ°è°ƒæ•´è¶…å‚æ•°çš„å€¼ã€‚

*æ³¨:æœ€æ–°çš„ä»£ç ç¤ºä¾‹è¯·å‚è€ƒ [Neptune-LightGBM é›†æˆæ–‡æ¡£](https://web.archive.org/web/20230127191010/https://docs.neptune.ai/integrations/lightgbm/)ã€‚*

åˆ›å»ºåŸºå‡†åŸ¹è®­ä»£ç :

```py
from sklearn.metrics import roc_auc_score, roc_curve
from sklearn.model_selection import train_test_split
import neptunecontrib.monitoring.skopt as sk_utils
import lightgbm as lgb
import pandas as pd
import neptune
import skopt
import sys
import os

SEARCH_PARAMS = {'learning_rate': 0.4,
                'max_depth': 15,
                'num_leaves': 32,
                'feature_fraction': 0.8,
                'subsample': 0.2}

FIXED_PARAMS={'objective': 'binary',
             'metric': 'auc',
             'is_unbalance':True,
             'bagging_freq':5,
             'boosting':'dart',
             'num_boost_round':300,
             'early_stopping_rounds':30}

def train_evaluate(search_params):
   # you can download the dataset from this link(https://www.kaggle.com/c/santander-customer-transaction-prediction/data)
   # import Dataset to play with it
   data= pd.read_csv("sample_train.csv")
   X = data.drop(['ID_code', 'target'], axis=1)
   y = data['target']
   X_train, X_valid, y_train, y_valid = train_test_split(X, y, test_size=0.2, random_state=1234)
   train_data = lgb.Dataset(X_train, label=y_train)
   valid_data = lgb.Dataset(X_valid, label=y_valid, reference=train_data)

   params = {'metric':FIXED_PARAMS['metric'],
             'objective':FIXED_PARAMS['objective'],
             **search_params}

   model = lgb.train(params, train_data,
                     valid_sets=[valid_data],
                     num_boost_round=FIXED_PARAMS['num_boost_round'],
                     early_stopping_rounds=FIXED_PARAMS['early_stopping_rounds'],
                     valid_names=['valid'])
   score = model.best_score['valid']['auc']
   return score
```

ä½¿ç”¨æ‚¨é€‰æ‹©çš„è¶…å‚æ•°ä¼˜åŒ–åº“(ä¾‹å¦‚ scikit-optimize):

```py
neptune.init('mjbahmani/LightGBM-hyperparameters')
neptune.create_experiment('lgb-tuning_final', upload_source_files=['*.*'],
                              tags=['lgb-tuning', 'dart'],params=SEARCH_PARAMS)

SPACE = [
   skopt.space.Real(0.01, 0.5, name='learning_rate', prior='log-uniform'),
   skopt.space.Integer(1, 30, name='max_depth'),
   skopt.space.Integer(10, 200, name='num_leaves'),
   skopt.space.Real(0.1, 1.0, name='feature_fraction', prior='uniform'),
   skopt.space.Real(0.1, 1.0, name='subsample', prior='uniform')
]
@skopt.utils.use_named_args(SPACE)
def objective(**params):
   return -1.0 * train_evaluate(params)

monitor = sk_utils.NeptuneMonitor()
results = skopt.forest_minimize(objective, SPACE,
                                n_calls=100, n_random_starts=10,
                                callback=[monitor])
sk_utils.log_results(results)

neptune.stop()
```

å°è¯•ä¸åŒç±»å‹çš„é…ç½®ï¼Œå¹¶åœ¨ Neptune åº”ç”¨ç¨‹åºä¸­è·Ÿè¸ªæ‚¨çš„ç»“æœã€‚

æœ€åï¼Œåœ¨ä¸‹è¡¨ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å‚æ•°å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ã€‚

è¶…å‚æ•°

| è°ƒè°å‰ | è°ƒè°å |  |
| --- | --- | --- |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  |  |
|  |  | æœ€åçš„æƒ³æ³• |

## é•¿è¯çŸ­è¯´ï¼Œä½ å­¦åˆ°äº†:

ä»€ä¹ˆæ˜¯ä¸»è¦çš„ lightgbm å‚æ•°

*   å¦‚ä½•ä½¿ç”¨ feval å‡½æ•°åˆ›å»ºå®šåˆ¶æŒ‡æ ‡
*   ä¸»è¦å‚æ•°æœ‰å“ªäº›å¥½çš„é»˜è®¤å€¼
*   æŸ¥çœ‹äº†å¦‚ä½•è°ƒæ•´ lightgbm å‚æ•°ä»¥æé«˜æ¨¡å‹æ€§èƒ½çš„ç¤ºä¾‹
*   å’Œå…¶ä»–ä¸€äº›ä¸œè¥¿ğŸ™‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è€ƒå‚è€ƒèµ„æ–™ã€‚

èµ„æº

### [Laurae å¹¿æ³›çš„æŒ‡å—ï¼Œå…·æœ‰è‰¯å¥½çš„é»˜è®¤è®¾ç½®ç­‰](https://web.archive.org/web/20230127191010/https://sites.google.com/view/lauraepp/parameters)

1.  [https://github . com/Microsoft/light GBM/tree/master/python-package](https://web.archive.org/web/20230127191010/https://github.com/microsoft/LightGBM/tree/master/python-package)
2.  [https://lightgbm.readthedocs.io/en/latest/index.html](https://web.archive.org/web/20230127191010/https://lightgbm.readthedocs.io/en/latest/index.html)
3.  [https://papers . nips . cc/paper/6907-light GBM-a-high-efficient-gradient-boosting-decision-tree . pdf](https://web.archive.org/web/20230127191010/https://papers.nips.cc/paper/6907-lightgbm-a-highly-efficient-gradient-boosting-decision-tree.pdf)
4.  [https://statweb.stanford.edu/~jhf/ftp/trebst.pdf](https://web.archive.org/web/20230127191010/https://statweb.stanford.edu/~jhf/ftp/trebst.pdf)
5.  [https://statweb.stanford.edu/~jhf/ftp/trebst.pdf](https://web.archive.org/web/20230127191010/https://statweb.stanford.edu/~jhf/ftp/trebst.pdf)**