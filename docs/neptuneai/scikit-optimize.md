# scikit Optimize:Python ä¸­çš„è´å¶æ–¯è¶…å‚æ•°ä¼˜åŒ–

> åŽŸæ–‡ï¼š<https://web.archive.org/web/https://neptune.ai/blog/scikit-optimize>

éœ€è¦è°ƒæ•´æœºå™¨å­¦ä¹ æ¨¡åž‹çš„è¶…å‚æ•°ï¼Œä½†ä¸æƒ³æ‰‹åŠ¨å®Œæˆï¼Ÿ

æ­£åœ¨è€ƒè™‘æ‰§è¡Œè´å¶æ–¯è¶…å‚æ•°ä¼˜åŒ–ï¼Œä½†æ‚¨ä¸ç¡®å®šå…·ä½“å¦‚ä½•æ“ä½œï¼Ÿ

å¬è¯´è¿‡å„ç§è¶…å‚æ•°ä¼˜åŒ–åº“ï¼Œæƒ³çŸ¥é“ [Scikit Optimize](https://web.archive.org/web/20221008042213/https://scikit-optimize.github.io/) æ˜¯å¦æ˜¯é€‚åˆæ‚¨çš„å·¥å…·ï¼Ÿ

ä½ æ¥å¯¹åœ°æ–¹äº†ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†:

*   å‘æ‚¨å±•ç¤ºä¸€ä¸ªä½¿ç”¨ skopt åœ¨å®žé™…é—®é¢˜ä¸Šè¿è¡Œè´å¶æ–¯è¶…å‚æ•°ä¼˜åŒ–çš„**ç¤ºä¾‹ï¼Œ**
*   **æ ¹æ® APIã€é€Ÿåº¦å’Œå®žéªŒç»“æžœç­‰å„ç§æ ‡å‡†è¯„ä¼°è¯¥åº“**ï¼Œ
*   ç»™ä½ æˆ‘çš„**æ€»è¯„åˆ†å’Œä½•æ—¶ä½¿ç”¨çš„å»ºè®®**ã€‚

æˆ‘ä»¬å¼€å§‹å§ï¼Œå¥½å—ï¼Ÿ

## è¯„å®šæ ‡å‡†

## æ˜“ç”¨æ€§å’Œ API

API å¤ªæ£’äº†ã€‚å®ƒæ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºŽä½ å‡ ä¹Žä¸ç”¨çœ‹æ–‡æ¡£å°±èƒ½çŒœåˆ°ã€‚è¯´çœŸçš„ï¼Œè®©æˆ‘ç»™ä½ çœ‹çœ‹ã€‚

æ‚¨å®šä¹‰æœç´¢ç©ºé—´:

```py
SPACE = [
   skopt.space.Real(0.01, 0.5, name='learning_rate', prior='log-uniform'),
   skopt.space.Integer(1, 30, name='max_depth'),
   skopt.space.Integer(2, 100, name='num_leaves'),
   skopt.space.Integer(10, 1000, name='min_data_in_leaf'),
   skopt.space.Real(0.1, 1.0, name='feature_fraction', prior='uniform'),
   skopt.space.Real(0.1, 1.0, name='subsample', prior='uniform')]
```

æ‚¨å®šä¹‰æƒ³è¦æœ€å°åŒ–çš„ç›®æ ‡å‡½æ•°(ä¿®é¥°å®ƒï¼Œä»¥ä¿ç•™å‚æ•°åç§°):

```py
@skopt.utils.use_named_args(SPACE)
def objective(**params):
    all_params = {**params, **STATIC_PARAMS}
    return -1.0 * train_evaluate(X, y, all_params)
```

å¹¶è¿è¡Œä¼˜åŒ–:

```py
results = skopt.forest_minimize(objective, SPACE, **HPO_PARAMS)

```

å°±æ˜¯è¿™æ ·ã€‚æ‚¨éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯æ¬¡è¿­ä»£çš„æœ€ä½³å‚æ•°æˆ–åˆ†æ•°ï¼Œéƒ½ä¿å­˜åœ¨ results å¯¹è±¡ä¸­ã€‚è¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´è„šæœ¬çš„ä¾‹å­ï¼Œå¸¦æœ‰ä¸€äº›é¢å¤–çš„é™„åŠ åŠŸèƒ½ã€‚

è¶…çº§ç®€å•çš„è®¾ç½®å’Œç›´è§‚çš„ APIã€‚

> **10 / 10**

* * *

## é€‰é¡¹ã€æ–¹æ³•å’Œ(è¶…çº§)å‚æ•°

### æœç´¢ç©ºé—´

å¯¹äºŽè¶…å‚æ•°æœç´¢ç©ºé—´ï¼Œæ‚¨å¯ä»¥ä»Žä¸‰ä¸ªé€‰é¡¹ä¸­è¿›è¡Œé€‰æ‹©:

*   *ç©ºé—´ã€‚å®žæ•°*-æµ®ç‚¹å‚æ•°ç”±(aï¼Œb)èŒƒå›´å†…çš„å‡åŒ€å¯¹æ•°å‡åŒ€é‡‡æ ·ï¼Œ
*   *ç©ºé—´ã€‚æ•´æ•°*-æ•´æ•°å‚æ•°ä»Ž(aï¼Œb)èŒƒå›´å†…å‡åŒ€é‡‡æ ·ï¼Œ
*   *ç©ºé—´ã€‚åˆ†ç±»*-ç”¨äºŽåˆ†ç±»(æ–‡æœ¬)å‚æ•°ã€‚å°†ä»Žé€‰é¡¹åˆ—è¡¨ä¸­æŠ½å–ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä½ æ­£åœ¨è®­ç»ƒ lightGBMï¼Œä½ å¯ä»¥é€šè¿‡['gbdt 'ï¼Œ' dart 'ï¼Œ' goss']ã€‚

æ²¡æœ‰å¯¹åµŒå¥—æœç´¢ç©ºé—´çš„æ”¯æŒï¼ŒåµŒå¥—æœç´¢ç©ºé—´è€ƒè™‘äº†è¶…å‚æ•°çš„ä¸€äº›ç»„åˆå®Œå…¨æ— æ•ˆçš„æƒ…å†µã€‚æœ‰æ—¶å€™çœŸçš„å¾ˆæ–¹ä¾¿ã€‚

### ä¼˜åŒ–æ–¹æ³•

æœ‰å››ç§ä¼˜åŒ–ç®—æ³•å¯ä»¥å°è¯•ã€‚

**dummy_minimize**

æ‚¨å¯ä»¥å¯¹å‚æ•°è¿›è¡Œç®€å•çš„éšæœºæœç´¢ã€‚è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œä½†æ˜¯å¦‚æžœéœ€è¦çš„è¯ï¼Œåœ¨åŒä¸€ä¸ª API ä¸­ä½¿ç”¨è¿™ä¸ªé€‰é¡¹è¿›è¡Œæ¯”è¾ƒæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

**forest_minimize å’Œ gbrt_minimize**

è¿™ä¸¤ç§æ–¹æ³•ä»¥åŠä¸‹ä¸€èŠ‚ä¸­çš„æ–¹æ³•éƒ½æ˜¯è´å¶æ–¯è¶…å‚æ•°ä¼˜åŒ–çš„ä¾‹å­ï¼Œä¹Ÿç§°ä¸ºåŸºäºŽåºåˆ—æ¨¡åž‹çš„ä¼˜åŒ– SMBOã€‚è¿™ç§æ–¹æ³•èƒŒåŽçš„æ€æƒ³æ˜¯ç”¨[éšæœºæ£®æž—](/web/20221008042213/https://neptune.ai/blog/random-forest-regression-when-does-it-fail-and-why)ã€é¢å¤–çš„æ ‘æˆ–è€…æ¢¯åº¦å¢žå¼ºæ ‘**å›žå½’é‡**æ¥**ä¼°è®¡**ç”¨æˆ·å®šä¹‰çš„**ç›®æ ‡å‡½æ•°** **ã€‚**

åœ¨ç›®æ ‡å‡½æ•°ä¸Šæ¯æ¬¡è¿è¡Œè¶…å‚æ•°åŽï¼Œç®—æ³•è¿›è¡Œ**æœ‰æ ¹æ®çš„çŒœæµ‹ï¼Œå“ªç»„è¶…å‚æ•°æœ€æœ‰å¯èƒ½æé«˜åˆ†æ•°**ï¼Œå¹¶ä¸”åº”è¯¥åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œä¸­å°è¯•ã€‚å®ƒæ˜¯é€šè¿‡èŽ·å¾—è®¸å¤šç‚¹(è¶…å‚æ•°é›†)ä¸Šçš„å›žå½’é¢„æµ‹ï¼Œå¹¶æ ¹æ®æ‰€è°“çš„èŽ·å–å‡½æ•°é€‰æ‹©æœ€ä½³çŒœæµ‹ç‚¹æ¥å®Œæˆçš„ã€‚

æœ‰è®¸å¤šé‡‡é›†åŠŸèƒ½é€‰é¡¹å¯ä¾›é€‰æ‹©:

*   ***EI å’Œ PI*** :è´Ÿé¢„æœŸæ”¹å–„å’Œè´Ÿæ¦‚çŽ‡æ”¹å–„ã€‚å¦‚æžœä½ é€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œä½ ä¹Ÿåº”è¯¥è°ƒæ•´***ã€Xiã€‘***å‚æ•°ã€‚åŸºæœ¬ä¸Šï¼Œå½“æ‚¨çš„ç®—æ³•å¯»æ‰¾ä¸‹ä¸€ç»„è¶…å‚æ•°æ—¶ï¼Œæ‚¨å¯ä»¥å†³å®šæ‚¨æ„¿æ„åœ¨å®žé™…ç›®æ ‡å‡½æ•°ä¸Šå°è¯•çš„é¢„æœŸæ”¹è¿›æœ‰å¤šå°ã€‚è¯¥å€¼è¶Šé«˜ï¼Œå›žå½’å˜é‡é¢„æœŸçš„æ”¹å–„(æˆ–æ”¹å–„æ¦‚çŽ‡)å°±è¶Šå¤§ã€‚
*   ***ã€LCBã€‘***:ç½®ä¿¡ä¸‹é™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ è¦è°¨æ…Žé€‰æ‹©ä½ çš„ä¸‹ä¸€ä¸ªç‚¹ï¼Œé™åˆ¶ä¸‹è¡Œé£Žé™©ã€‚ä½ å¯ä»¥å†³å®šæ¯æ¬¡è·‘æ­¥è¦å†’å¤šå¤§çš„é£Žé™©ã€‚é€šè¿‡ä½¿***Îº***å‚æ•°å˜å°ï¼Œä½ å€¾å‘äºŽ**åˆ©ç”¨**ä½ æ‰€çŸ¥é“çš„ï¼Œé€šè¿‡ä½¿å…¶å˜å¤§ï¼Œä½ å€¾å‘äºŽ**æŽ¢ç´¢**æœç´¢ç©ºé—´ã€‚

è¿˜æœ‰é€‰é¡¹***ã€EIPSã€‘***å’Œ ***PIPS*** è€ƒè™‘åˆ°ç›®æ ‡å‡½æ•°äº§ç”Ÿçš„åˆ†æ•°å’Œæ‰§è¡Œæ—¶é—´ï¼Œä½†æˆ‘æ²¡æœ‰å°è¯•è¿‡

**gp_minimize**

ä¸ä½¿ç”¨æ ‘å½¢å›žå½’ï¼Œç›®æ ‡å‡½æ•°ç”±é«˜æ–¯è¿‡ç¨‹è¿‘ä¼¼ã€‚

ä»Žç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§æ–¹æ³•çš„é™„åŠ ä»·å€¼æ˜¯ï¼Œä½ å¯ä»¥è®©ç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­é€‰æ‹© EIã€PI å’Œ LCB ä¸­æœ€å¥½çš„ä¸€ä¸ªï¼Œè€Œä¸æ˜¯äº‹å…ˆå†³å®šä¸€ä¸ªé‡‡é›†å‡½æ•°ã€‚åªéœ€å°†é‡‡é›†åŠŸèƒ½è®¾ç½®ä¸º *gp_hedge* å¹¶è¯•ç”¨å³å¯ã€‚

è¿˜æœ‰ä¸€ç‚¹è¦è€ƒè™‘çš„æ˜¯æ¯æ¬¡è¿­ä»£ä½¿ç”¨çš„**ä¼˜åŒ–æ–¹æ³•**ã€*é‡‡æ ·*æˆ– *lbfgs* ã€‚å¯¹äºŽè¿™ä¸¤è€…ï¼Œé‡‡é›†å‡½æ•°æ˜¯åœ¨æœç´¢ç©ºé—´ä¸­éšæœºé€‰æ‹©çš„ç‚¹æ•°( *n_points* )ä¸Šè®¡ç®—çš„ã€‚å¦‚æžœè¿›è¡Œé‡‡æ ·ï¼Œåˆ™é€‰æ‹©å…·æœ‰æœ€ä½Žå€¼çš„ç‚¹ã€‚å¦‚æžœæ‚¨é€‰æ‹© *lbfgs* ï¼Œè¯¥ç®—æ³•å°†ä»Žä¸€äº›(n _ restarts _ optimizer)æœ€ä½³çš„ã€éšæœºå°è¯•çš„ç‚¹ä¸­é€‰å–ï¼Œå¹¶å°†ä»Žæ¯ä¸ªç‚¹å¼€å§‹è¿è¡Œ *lbfgs* ä¼˜åŒ–ã€‚æ‰€ä»¥å¦‚æžœä½ ä¸åœ¨ä¹Žæ‰§è¡Œæ—¶é—´ï¼ŒåŸºæœ¬ä¸Š *lbfgs* æ–¹æ³•åªæ˜¯å¯¹é‡‡æ ·æ–¹æ³•çš„ä¸€ä¸ªæ”¹è¿›ã€‚

### å›žæ”¶

æˆ‘çœŸçš„å¾ˆå–œæ¬¢æœ‰ä¸€ä¸ªé€šè¿‡å›žè°ƒçš„ç®€å•é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥é€šè¿‡ç®€å•åœ°æ·»åŠ  3 è¡Œä»£ç æ¥ç›‘æŽ§æˆ‘çš„è®­ç»ƒ:

```py
def monitor(res):
    neptune.send_metric('run_score', res.func_vals[-1])
    neptune.send_text('run_parameters', 
                      str(to_named_params(res.x_iters[-1])))
...
results = skopt.forest_minimize(objective, SPACE, 
                                callback=[monitor], **HPO_PARAMS)
```

æ‚¨å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹çš„å…¶ä»–äº‹æƒ…æ˜¯ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­æå‰åœæ­¢æˆ–ä¿å­˜ç»“æžœã€‚

* * *

è¯·æ³¨æ„ï¼Œç”±äºŽæœ€è¿‘çš„ [API æ›´æ–°](/web/20221008042213/https://neptune.ai/blog/neptune-new)ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿéœ€è¦ä¸€äº›æ”¹å˜â€”â€”æˆ‘ä»¬æ­£åœ¨åŠªåŠ›ï¼ä¸Žæ­¤åŒæ—¶ï¼Œè¯·æ£€æŸ¥[æµ·çŽ‹æ˜Ÿæ–‡æ¡£](https://web.archive.org/web/20221008042213/https://docs.neptune.ai/)ï¼Œé‚£é‡Œçš„ä¸€åˆ‡éƒ½æ˜¯æœ€æ–°çš„ï¼ðŸ¥³

* * *

### æŒç»­å’Œé‡æ–°å¯åŠ¨

æœ‰*ç›®çš„è½¬å‚¨*å’Œ*ç›®çš„åŠ è½½*å‡½æ•°å¤„ç†*ç»“æžœ*å¯¹è±¡çš„ä¿å­˜å’ŒåŠ è½½ï¼›

```py
results = skopt.forest_minimize(objective, SPACE, **HPO_PARAMS)
skopt.dump(results, 'artifacts/results.pkl')
old_results = skopt.load('artifacts/results.pkl')
```

æ‚¨å¯ä»¥é€šè¿‡ *x0* å’Œ *y0* å‚æ•°ä»Žä¿å­˜çš„ç»“æžœé‡æ–°å¼€å§‹è®­ç»ƒã€‚ä¾‹å¦‚:

```py
results = skopt.forest_minimize(objective, SPACE,
                                x0=old_results.x_iters,
                                y0=old_results.func_vals,
                                **HPO_PARAMS)
```

ç®€å•å’Œå·¥ç¨‹æ²¡æœ‰é—®é¢˜ã€‚

æ€»çš„æ¥è¯´ï¼Œæœ‰å¾ˆå¤šè°ƒæ•´(è¶…)è¶…å‚æ•°çš„é€‰é¡¹ï¼Œæ‚¨å¯ä»¥é€šè¿‡å›žè°ƒæ¥æŽ§åˆ¶è®­ç»ƒã€‚å¦ä¸€æ–¹é¢ï¼Œæ‚¨åªèƒ½åœ¨å¹³å¦çš„ç©ºé—´ä¸­æœç´¢ï¼Œå¹¶ä¸”æ‚¨éœ€è¦è‡ªå·±å¤„ç†é‚£äº›è¢«ç¦æ­¢çš„å‚æ•°ç»„åˆã€‚

> **2010 å¹´ 7 æœˆ**

* * *

## è¯æ˜Žæ–‡ä»¶

ä¸€ä»¶è‰ºæœ¯å“ã€‚

å®ƒæœ‰å¾ˆå¤šä¾‹å­ï¼Œæ‰€æœ‰å‡½æ•°å’Œæ–¹æ³•çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚æˆ‘åªèŠ±äº†å‡ åˆ†é’Ÿå°±è¿›å…¥äº†æœ€ä½³çŠ¶æ€ï¼Œå¹¶æŠŠäº‹æƒ…åšå¥½äº†ã€‚

åŽ»[æ–‡æ¡£ç½‘é¡µ](https://web.archive.org/web/20221008042213/https://scikit-optimize.github.io/)è‡ªå·±çœ‹ã€‚

å®ƒå¯ä»¥æ›´å¥½ä¸€ç‚¹ï¼Œåœ¨ docstrings ä¸­æœ‰æ›´å¤šçš„è§£é‡Šï¼Œä½†æ€»ä½“ä½“éªŒéžå¸¸å¥½ã€‚

> **9 / 10**

* * *

## å½¢è±¡åŒ–

è¿™æ˜¯è¿™ä¸ªå›¾ä¹¦é¦†æˆ‘æœ€å–œæ¬¢çš„ç‰¹è‰²ä¹‹ä¸€ã€‚åœ¨ *skopt.plots* æ¨¡å—ä¸­æœ‰ä¸‰ä¸ªç»˜å›¾å·¥å…·ï¼Œæˆ‘éžå¸¸å–œæ¬¢:

*   *plot _ convergence*-å®ƒé€šè¿‡æ˜¾ç¤ºæ¯æ¬¡è¿­ä»£çš„æœ€ä½³ç»“æžœæ¥å¯è§†åŒ–æ‚¨çš„ä¼˜åŒ–è¿›åº¦ã€‚

```py
import skopt.plots

skopt.plots.plot_convergence(results)
```

å®ƒçš„é…·ä¹‹å¤„åœ¨äºŽï¼Œä½ å¯ä»¥é€šè¿‡ç®€å•åœ°ä¼ é€’ä¸€ä¸ª *results* å¯¹è±¡åˆ—è¡¨æˆ–è€…ä¸€ä¸ª(nameï¼Œresults)å…ƒç»„çš„**åˆ—è¡¨æ¥æ¯”è¾ƒè®¸å¤šç­–ç•¥çš„è¿›å±•ã€‚**

```py
results = [('random_results', random_results),
           ('forest_results', forest_results),
           ('gbrt_results', gbrt_results),
           ('gp_results', gp_results)]

skopt.plots.plot_convergence(*results)
```

*   è¿™ä¸ªå›¾è®©ä½ çœ‹åˆ°æœç´¢çš„å‘å±•ã€‚å¯¹äºŽæ¯ä¸ªè¶…å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æŽ¢æµ‹å€¼çš„ç›´æ–¹å›¾ã€‚å¯¹äºŽæ¯ä¸€å¯¹è¶…å‚æ•°ï¼Œé‡‡æ ·å€¼çš„æ•£ç‚¹å›¾ç”¨é¢œè‰²è¡¨ç¤ºï¼Œä»Žè“è‰²åˆ°é»„è‰²ã€‚

ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æŸ¥çœ‹**éšæœºæœç´¢ç­–ç•¥**æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ²¡æœ‰è¿›åŒ–ã€‚å®ƒåªæ˜¯éšæœºæœç´¢:

ä½†æ˜¯å¯¹äºŽ*forest _ minimize***ç­–ç•¥ï¼Œ**æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œå®ƒæ”¶æ•›åˆ°å®ƒæŽ¢ç´¢å¾—æ›´å¤šçš„ç©ºé—´çš„æŸäº›éƒ¨åˆ†ã€‚

*   *plot _ objective*-å®ƒè®©ä½ èŽ·å¾—å¯¹è¶…å‚æ•°çš„åˆ†æ•°æ•æ„Ÿåº¦çš„ç›´è§‰ã€‚æ‚¨å¯ä»¥å†³å®šç©ºé—´çš„å“ªäº›éƒ¨åˆ†å¯èƒ½éœ€è¦æ›´ç»†ç²’åº¦çš„æœç´¢ï¼Œä»¥åŠå“ªäº›è¶…å‚æ•°å‡ ä¹Žä¸å½±å“åˆ†æ•°ï¼Œå¹¶ä¸”å¯èƒ½ä¼šä»Žæœç´¢ä¸­åˆ é™¤ã€‚

æ€»çš„æ¥è¯´ï¼Œå¯è§†åŒ–éžå¸¸å¥½ã€‚

> **10 / 10**

* * *

### æ³¨æ„:

æˆ‘éžå¸¸å–œæ¬¢å®ƒï¼Œæ‰€ä»¥æˆ‘åˆ›å»ºäº†ä¸€ç»„å‡½æ•°æ¥å¸®åŠ©ä¸åŒ HPO åº“ä¹‹é—´çš„è½¬æ¢ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¯¹æ¯ä¸ªåº“ä½¿ç”¨è¿™äº›å¯è§†åŒ–ã€‚æˆ‘å·²ç»æŠŠå®ƒä»¬æ”¾åœ¨äº† neptune-contrib åŒ…ä¸­ï¼Œä½ å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ã€‚

## é€Ÿåº¦å’Œå¹¶è¡ŒåŒ–

æ¯ä¸ªä¼˜åŒ–å‡½æ•°éƒ½å¸¦æœ‰ *n_jobs* å‚æ•°ï¼Œè¯¥å‚æ•°è¢«ä¼ é€’ç»™ *base_estimator* ã€‚è¿™æ„å‘³ç€ï¼Œå³ä½¿ä¼˜åŒ–è¿è¡ŒæŒ‰é¡ºåºè¿›è¡Œï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡åˆ©ç”¨æ›´å¤šçš„èµ„æºæ¥åŠ é€Ÿæ¯æ¬¡è¿è¡Œã€‚

æˆ‘è¿˜æ²¡æœ‰ä¸ºæ‰€æœ‰çš„ä¼˜åŒ–æ–¹æ³•å’Œ n_jobs è¿è¡Œä¸€ä¸ªåˆé€‚çš„è®¡æ—¶åŸºå‡†ã€‚ç„¶è€Œï¼Œå› ä¸ºæˆ‘è®°å½•äº†æ‰€æœ‰å®žéªŒçš„æ€»æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä»¥æˆ‘å†³å®šç»™å‡ºæˆ‘è¿è¡Œçš„æ‰€æœ‰å®žéªŒçš„å¹³å‡æ—¶é—´:

æ˜¾ç„¶ï¼Œ**éšæœºæœç´¢æ–¹æ³•æ˜¯æœ€å¿«çš„**ï¼Œå› ä¸ºå®ƒåœ¨ä¸¤æ¬¡è¿è¡Œä¹‹é—´ä¸éœ€è¦ä»»ä½•è®¡ç®—ã€‚å…¶æ¬¡æ˜¯**æ¢¯åº¦å¢žå¼ºæ ‘å›žå½’å™¨**å’Œ**éšæœºæ£®æž—æ–¹æ³•**ã€‚é€šè¿‡**ä¼˜åŒ–é«˜æ–¯è¿‡ç¨‹æ˜¯æœ€æ…¢çš„**ï¼Œä½†æˆ‘åªæµ‹è¯•äº† *gp_hedge* é‡‡é›†å‡½æ•°ï¼Œè¿™å¯èƒ½å°±æ˜¯åŽŸå› ã€‚

å› ä¸ºæ²¡æœ‰åœ¨è¿è¡Œçº§åˆ«ä¸Šï¼Œåœ¨ä¸€ä¸ªå·¥äººé›†ç¾¤ä¸Šåˆ†é…å®ƒçš„é€‰é¡¹ï¼Œæ‰€ä»¥æˆ‘å¿…é¡»æ‹¿èµ°å‡ ä¸ªç‚¹ã€‚

> **2010 å¹´ 6 æœˆ**

* * *

## å®žéªŒç»“æžœ

ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬åœ¨ä¸€ä¸ªè¡¨æ ¼ï¼Œ**äºŒå…ƒåˆ†ç±»**é—®é¢˜ä¸Šè°ƒæ•´ **lightGBM** æ¨¡åž‹çš„è¶…å‚æ•°ã€‚å¦‚æžœæ‚¨æƒ³åƒæˆ‘ä¸€æ ·ä½¿ç”¨ç›¸åŒçš„æ•°æ®é›†ï¼Œæ‚¨åº”è¯¥:

ä¸ºäº†è®©è®­ç»ƒæ›´å¿«ï¼Œæˆ‘å°†**çš„åŠ©æŽ¨è½®æ•°å›ºå®šä¸º 300ï¼Œå¹¶æå‰ 30 è½®åœæ­¢**ã€‚

```py
import lightgbm as lgb
from sklearn.model_selection import train_test_split

NUM_BOOST_ROUND = 300
EARLY_STOPPING_ROUNDS = 30

def train_evaluate(X, y, params):
    X_train, X_valid, y_train, y_valid = train_test_split(X, y, 
                                                          test_size=0.2, 
                                                          random_state=1234)

    train_data = lgb.Dataset(X_train, label=y_train)
    valid_data = lgb.Dataset(X_valid, label=y_valid, reference=train_data)

    model = lgb.train(params, train_data,
                      num_boost_round=NUM_BOOST_ROUND,
                      early_stopping_rounds=EARLY_STOPPING_ROUNDS,
                      valid_sets=[valid_data], 
                      valid_names=['valid'])

    score = model.best_score['valid']['auc']
    return score
```

æ‰€æœ‰çš„è®­ç»ƒå’Œè¯„ä¼°é€»è¾‘éƒ½æ”¾åœ¨ **train_evaluate** å‡½æ•°ä¸­ã€‚æˆ‘ä»¬å¯ä»¥**å°†å…¶è§†ä¸ºä¸€ä¸ªé»‘ç›’**ï¼Œå®ƒèŽ·å–æ•°æ®å’Œè¶…å‚æ•°é›†å¹¶ç”Ÿæˆ AUC è¯„ä¼°åˆ†æ•°ã€‚

### æ³¨æ„:

ä½ å¯ä»¥æŠŠæ¯ä¸€ä¸ªä»¥å‚æ•°ä¸ºè¾“å…¥ï¼Œè¾“å‡ºåˆ†æ•°çš„è„šæœ¬éƒ½å˜æˆè¿™æ ·çš„ **train_evaluateã€‚**å®ŒæˆåŽï¼Œæ‚¨å¯ä»¥å°†å…¶è§†ä¸ºä¸€ä¸ªé»‘ç›’ï¼Œå¹¶è°ƒæ•´æ‚¨çš„å‚æ•°ã€‚

è¦æ ¹æ®ä¸€ç»„å‚æ•°è®­ç»ƒæ¨¡åž‹ï¼Œæ‚¨å¯ä»¥è¿è¡Œå¦‚ä¸‹å†…å®¹:

```py
import pandas as pd

N_ROWS=10000
TRAIN_PATH = '/mnt/ml-team/minerva/open-solutions/santander/data/train.csv'

data = pd.read_csv(TRAIN_PATH, nrows=N_ROWS)
X = data.drop(['ID_code', 'target'], axis=1)
y = data['target']

MODEL_PARAMS = {'boosting': 'gbdt',
                'objective':'binary',
                'metric': 'auc',
                'num_threads': 12,
                'learning_rate': 0.3,
                }

score = train_evaluate(X, y, MODEL_PARAMS)
print('Validation AUC: {}'.format(score))
```

å¯¹äºŽè¿™é¡¹ç ”ç©¶ï¼Œæˆ‘å°†å°è¯•åœ¨ **100 æ¬¡è¿è¡Œé¢„ç®—**å†…æ‰¾åˆ°æœ€ä½³å‚æ•°ã€‚

å¦‚æžœä½ **åœ¨è¶…å‚æ•°**ä¸Šéšæœºæœç´¢**ï¼Œä½ å¯ä»¥å¾—åˆ° 0.864** ï¼Œæ­£å¦‚æˆ‘åœ¨è¿™ä¸ª [ml å®žéªŒ](https://web.archive.org/web/20221008042213/https://ui.neptune.ai/jakub-czakon/blog-hpo/e/BLOG-90/logs)ä¸­æ‰€ç¤ºã€‚

ä¸ºäº†æ‰¾åˆ°æœ€ä½³æ¨¡åž‹ï¼Œæˆ‘å°è¯•äº†æ¥è‡ª[é€‰é¡¹ã€æ–¹æ³•å’Œ hyper(è¶…å‚æ•°)](/web/20221008042213/https://neptune.ai/blog/scikit-optimize#2)éƒ¨åˆ†çš„ä¼˜åŒ–å™¨å’Œ hyper(è¶…å‚æ•°)çš„å„ç§é…ç½®ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ç¤ºä¾‹ [skopt å‚æ•°è°ƒæ•´](https://web.archive.org/web/20221008042213/https://ui.neptune.ai/jakub-czakon/blog-hpo/e/BLOG-90/source-code?file=search_random.py)è„šæœ¬ã€‚

æˆ‘æ€»å…±è¿›è¡Œäº† 87 æ¬¡å®žéªŒï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å‰å‡ é¡¹:

[![skopt experiments](img/85f17807424c45dad12e85bfb99aecfb.png)](https://web.archive.org/web/20221008042213/https://ui.neptune.ai/jakub-czakon/blog-hpo/experiments?viewId=817cbbbb-103e-11ea-9a39-42010a840083&trashed=false&searchMode=simple&lbViewUnpacked=true&tags=%5B%22skopt%22%5D)

*Experiments for different skopt configurations*

å¦‚æžœä½ æƒ³æ›´è¯¦ç»†åœ°æŽ¢ç´¢æ‰€æœ‰è¿™äº›å®žéªŒï¼Œä½ å¯ä»¥ç®€å•åœ°è¿›å…¥[å®žéªŒä»ªè¡¨æ¿](https://web.archive.org/web/20221008042213/https://ui.neptune.ai/jakub-czakon/blog-hpo/experiments?viewId=817cbbbb-103e-11ea-9a39-42010a840083&trashed=false&searchMode=simple&lbViewUnpacked=true&tags=%5B%22skopt%22%5D)ã€‚

*forest_minimize* **æ–¹æ³•æ˜¯æ˜Žæ˜¾çš„èµ¢å®¶**ï¼Œä½†æ˜¯ä¸ºäº†èŽ·å¾—å¥½çš„ç»“æžœï¼Œç¨å¾®è°ƒæ•´ä¸€ä¸‹(è¶…çº§)è¶…å‚æ•°æ˜¯è‡³å…³é‡è¦çš„ã€‚å¯¹äºŽ *LCB* é‡‡é›†å‡½æ•°æ¥è¯´ï¼Œ*Îº*(å‰¥å‰Š)çš„å€¼è¶Šä½Žè¶Šå¥½ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå®žéªŒçš„è¯„ä¼°å›¾:

å®ƒåˆ©ç”¨äº†ä½Ž *num_leaves* å­ç©ºé—´ï¼Œä½†å¯¹äºŽ *max_depth* å’Œ *feature_fraction* æ¥è¯´ï¼Œå®ƒéžå¸¸å…·æœ‰æŽ¢ç´¢æ€§ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™äº›å›¾åœ¨ä¸åŒçš„å®žéªŒä¸­å·®åˆ«å¾ˆå¤§ã€‚è¿™è®©ä½ æƒ³çŸ¥é“é™·å…¥å±€éƒ¨æœ€å°å€¼æœ‰å¤šå®¹æ˜“ã€‚

ç„¶è€Œï¼Œ**æœ€ä½³ç»“æžœæ˜¯é€šè¿‡ EI é‡‡é›†**åŠŸèƒ½èŽ·å¾—çš„ã€‚å†æ¬¡ï¼Œè°ƒæ•´ *xi* å‚æ•°æ˜¯å¿…è¦çš„ã€‚çœ‹è¿™ä¸ªå®žéªŒçš„å®¢è§‚æƒ…èŠ‚:

æˆ‘è§‰å¾—ï¼Œé€šè¿‡åˆ é™¤ä¸€äº›ä¸æ•æ„Ÿçš„ç»´åº¦(*å­æ ·æœ¬*ã€*æœ€å¤§æ·±åº¦*)å¹¶å¯¹å…¶ä»–è¶…å‚æ•°è¿›è¡Œæ›´ç»†ç²’åº¦çš„æœç´¢ï¼Œæˆ‘å¯èƒ½ä¼šå¾—åˆ°æ›´å¥½çš„ç»“æžœã€‚

ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œå½“æˆ‘ä½¿ç”¨ lbfgs é‡‡é›†å‡½æ•°ä¼˜åŒ–æ—¶ï¼Œ*gp _ minimize*çš„ç»“æžœæ˜Žæ˜¾æ›´å·®ã€‚ä»–ä»¬ä¸èƒ½æ‰“è´¥éšæœºæœç´¢ã€‚å°†ä¼˜åŒ–æ”¹ä¸ºé‡‡æ ·èŽ·å¾—äº†æ›´å¥½çš„ AUCï¼Œä½†ä»ç„¶æ¯” *forest_minimize* å’Œ *gbrt_minimize* å·®ã€‚åŽ»[é«˜æ–¯å·¥è‰ºå®žéªŒ](https://web.archive.org/web/20221008042213/https://ui.neptune.ai/jakub-czakon/blog-hpo/experiments?viewId=dc5bdd19-0ff3-4ac8-9d4a-b695545ab68d)è‡ªå·±çœ‹ã€‚

æ€»çš„æ¥è¯´ï¼Œæˆ‘èƒ½å¾—åˆ°çš„æœ€é«˜åˆ†æ˜¯ 0.8566 ï¼Œæ¯”éšæœºæœç´¢çš„ 0.8464 é«˜å‡º 0.01ã€‚æˆ‘å°†æŠŠå®ƒç¿»è¯‘æˆ **10 ç‚¹** (0.01*100)ã€‚

> **10/10**

* * *

## ç»“è®º

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰€æœ‰æ ‡å‡†çš„ç»“æžœ:

æ€»çš„æ¥è¯´ï¼Œ**æˆ‘éžå¸¸å–œæ¬¢ Scikit-Optimize** ã€‚è¿™æ˜¯ä¸€ä¸ªæ„‰å¿«çš„ä½¿ç”¨ï¼Œç»™ä½ å¾ˆå¤§çš„ç»“æžœï¼Œå’Œæœ‰ç”¨çš„å¯è§†åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒæœ‰è®¸å¤šé€‰é¡¹ï¼Œå¯ä»¥ç”¨å¼ºå¤§çš„æ–‡æ¡£æ¥æŒ‡å¯¼æ‚¨å®Œæˆå®ƒã€‚

å¦ä¸€æ–¹é¢ï¼Œå¾ˆéš¾**(å¦‚æžœä¸æ˜¯ä¸å¯èƒ½çš„è¯)**å°†å®ƒå¹¶è¡ŒåŒ–è¿è¡Œ**å¹¶åˆ†å¸ƒåœ¨ä¸€ä¸ªæœºå™¨é›†ç¾¤ä¸Šã€‚æˆ‘è®¤ä¸ºä»ŠåŽï¼Œè¿™å°†å˜å¾—æ›´åŠ é‡è¦ï¼Œå¹¶å¯èƒ½ä½¿è¿™ä¸ªåº“ä¸é€‚åˆæŸäº›åº”ç”¨ç¨‹åºã€‚**

 **æˆ‘çš„å»ºè®®æ˜¯ï¼Œå¦‚æžœä½ ä¸å¤ªå…³å¿ƒé€Ÿåº¦å’Œå¹¶è¡ŒåŒ–ï¼Œå°±ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å¦‚æžœè¿™äº›å¯¹ä½ çš„é¡¹ç›®è‡³å…³é‡è¦ï¼Œå°±åŽ»åˆ«å¤„çœ‹çœ‹ã€‚

### é›…å„å¸ƒÂ·æŸ¥è‚¯

å¤§éƒ¨åˆ†æ˜¯ ML çš„äººã€‚æž„å»º MLOps å·¥å…·ï¼Œç¼–å†™æŠ€æœ¯èµ„æ–™ï¼Œåœ¨ Neptune è¿›è¡Œæƒ³æ³•å®žéªŒã€‚

* * *

**é˜…è¯»ä¸‹ä¸€ç¯‡**

## å¦‚ä½•è·Ÿè¸ªæœºå™¨å­¦ä¹ æ¨¡åž‹çš„è¶…å‚æ•°ï¼Ÿ

å¡ç±³å°”Â·å¡ä»€é©¬é›·å…‹|å‘å¸ƒäºŽ 2020 å¹´ 7 æœˆ 1 æ—¥

**æœºå™¨å­¦ä¹ ç®—æ³•å¯é€šè¿‡ç§°ä¸ºè¶…å‚æ•°**çš„å¤šä¸ªé‡è§„è¿›è¡Œè°ƒæ•´ã€‚æœ€è¿‘çš„æ·±åº¦å­¦ä¹ æ¨¡åž‹å¯ä»¥é€šè¿‡æ•°åä¸ªè¶…å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¿™äº›è¶…å‚æ•°ä¸Žæ•°æ®æ‰©å……å‚æ•°å’Œè®­ç»ƒç¨‹åºå‚æ•°ä¸€èµ·åˆ›å»ºäº†éžå¸¸å¤æ‚çš„ç©ºé—´ã€‚åœ¨å¼ºåŒ–å­¦ä¹ é¢†åŸŸï¼Œæ‚¨è¿˜åº”è¯¥è®¡ç®—çŽ¯å¢ƒå‚æ•°ã€‚

æ•°æ®ç§‘å­¦å®¶è¦**æŽ§åˆ¶å¥½** **è¶…å‚æ•°** **ç©ºé—´**ï¼Œæ‰èƒ½**ä½¿** **è¿›æ­¥**ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤º**æœ€è¿‘çš„** **å®žè·µ**ï¼Œ**æç¤º&æŠ€å·§ï¼Œ**å’Œ**å·¥å…·**ä»¥æœ€å°çš„å¼€é”€é«˜æ•ˆåœ°è·Ÿè¸ªè¶…å‚æ•°ã€‚ä½ ä¼šå‘çŽ°è‡ªå·±æŽŒæŽ§äº†æœ€å¤æ‚çš„æ·±åº¦å­¦ä¹ å®žéªŒï¼

## ä¸ºä»€ä¹ˆæˆ‘åº”è¯¥è·Ÿè¸ªæˆ‘çš„è¶…å‚æ•°ï¼Ÿä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦ï¼Ÿ

å‡ ä¹Žæ¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ å®žéªŒæŒ‡å—ï¼Œåƒ[è¿™æœ¬æ·±åº¦å­¦ä¹ ä¹¦ç±](https://web.archive.org/web/20221008042213/https://www.deeplearningbook.org/contents/guidelines.html)ï¼Œéƒ½å»ºè®®ä½ å¦‚ä½•è°ƒæ•´è¶…å‚æ•°ï¼Œä½¿æ¨¡åž‹æŒ‰é¢„æœŸå·¥ä½œã€‚åœ¨**å®žéªŒ-åˆ†æž-å­¦ä¹ å¾ªçŽ¯**ä¸­ï¼Œæ•°æ®ç§‘å­¦å®¶å¿…é¡»æŽ§åˆ¶æ­£åœ¨è¿›è¡Œçš„æ›´æ”¹ï¼Œä»¥ä¾¿å¾ªçŽ¯çš„â€œå­¦ä¹ â€éƒ¨åˆ†æ­£å¸¸å·¥ä½œã€‚

å“¦ï¼Œå¿˜äº†è¯´**éšæœºç§å­ä¹Ÿæ˜¯ä¸€ä¸ªè¶…å‚æ•°**(ç‰¹åˆ«æ˜¯åœ¨ RL é¢†åŸŸ:ä¾‹å¦‚æ£€æŸ¥[è¿™ä¸ª Reddit](https://web.archive.org/web/20221008042213/https://www.reddit.com/r/MachineLearning/comments/76th74/d_why_random_seeds_sometimes_have_quite_large/) )ã€‚

## è¶…å‚æ•°è·Ÿè¸ªçš„å½“å‰å®žè·µæ˜¯ä»€ä¹ˆï¼Ÿ

è®©æˆ‘ä»¬é€ä¸€å›žé¡¾ä¸€ä¸‹ç®¡ç†è¶…å‚æ•°çš„å¸¸è§åšæ³•ã€‚æˆ‘ä»¬å…³æ³¨äºŽå¦‚ä½•æž„å»ºã€ä¿å­˜å’Œä¼ é€’è¶…å‚æ•°ç»™ä½ çš„ ML è„šæœ¬ã€‚

[Continue reading ->](/web/20221008042213/https://neptune.ai/blog/how-to-track-hyperparameters)

* * ***